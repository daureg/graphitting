\documentclass[a4paper,final,11pt]{article}
\usepackage[english]{babel}
\usepackage[utf8]{inputenc}
\usepackage{microtype}
\usepackage[autolanguage]{numprint}
\usepackage[svgnames]{xcolor}
\usepackage{listings}
\usepackage{textcomp}
\usepackage{setspace}
\lstset{backgroundcolor=\color{White},
	basicstyle=\ttfamily\small\setstretch{1},
	stringstyle=\color{Orange},
	showstringspaces=false,
	numbers=none,
	numberstyle=\tiny,
	keywordstyle=\color{YellowGreen},
	commentstyle=\color{DodgerBlue}\slshape,
	breaklines=true,
	escapeinside={(*@}{@*)},
	tabsize=2,
	caption=\lstname,
	inputencoding=utf8,
}
\lstloadlanguages{Matlab}
\lstset{language=Matlab}
\usepackage{amsmath}
\usepackage[left=1cm, right=1cm]{geometry}
\newcommand{\bm}[1]{\boldsymbol{#1}}
\begin{document}
	All the following is subject to $\bm{w},\bm{s}\geq0$:
\begin{align*}
\mathcal{L} &= \min_{\bm{w},\bm{s}} ||M\bm{w}||^2 + \mu||\mathbf{\bm{1}} - A\bm{w} - \bm{s}||^2 \\
	    &= \min_{\bm{w},\bm{s}} \bm{w}^TM^TM\bm{w} + \mu\left( (\bm{1}^T -\bm{w}^TA^T -\bm{s}^T)(\bm{1} - A\bm{w} - \bm{s})\right)\\
	    &= \min_{\bm{w},\bm{s}} \bm{w}^TM^TM\bm{w} + \mu\left( \bm{1}^T\bm{1} - \bm{1}^TA\bm{w} - \bm{1}^T\bm{s} -\bm{w}^TA^T\bm{1} +\bm{w}^TA^TA\bm{w} +\bm{w}^TA^T\bm{s}-\bm{s}^T\bm{1} +\bm{s}^T A\bm{w} +\bm{s}^T \bm{s}\right)\\
	    &= \min_{\bm{w},\bm{s}} \bm{w}^T(M^TM+\mu A^TA)\bm{w} +\mu \bm{s}^TI^TI\bm{s} +
	    \mu\left( 1 - 2 \bm{1}^TA\bm{w} - 2 \bm{1}^T\bm{s} +2\bm{w}^TA^T\bm{s}\right)\\
	    &= \min_{\bm{y}} \bm{y}^T
\underbrace{\begin{pmatrix}
M^TM+\mu A^TA & \mu A^T \\
\mu A & \mu I
\end{pmatrix}}_{C^TC}\bm{y} -2\begin{pmatrix}
\mu \bm{1}^TA \\
\mu \bm{1}^T
\end{pmatrix}\bm{y}
+\underbrace{\mu\bm{1}^T\bm{1}}_{\bm{d}^T\bm{d}}\\
&= \min_{\bm{y}} \bm{y}^T H \bm{y} + \bm{f}\bm{y}
\end{align*}
where $\bm{y}$ is the $m+n$ vector 
$
\begin{pmatrix}
	\bm{w}\\
	\bm{s}
\end{pmatrix}\geq0$. Yet it still does not look like:
\begin{align*}
\min_{\bm{y}} ||C\bm{y} - \bm{d} ||^2 = \min_{\bm{y}} \bm{y}^TC^TC\bm{y} - 2\bm{d}^TC\bm{y} + \bm{d}^T\bm{d}
\end{align*}
because of $M$.

\begin{center}
\lstinputlisting[caption={Solving minimization problem with the subset
method},label={lst:cg},texcl]{compute_graph.m}
\lstinputlisting[caption={Computing hard
graph},label={lst:chg},texcl]{compute_hard_graph.m}
\lstinputlisting[caption={Computing $\alpha$-soft
graph},label={lst:csg},texcl]{compute_alpha_graph.m}
\lstinputlisting[caption={Use the built graph to classify
samples},label={lst:gcl},texcl]{graph_classify.m}
\end{center}
\end{document}
